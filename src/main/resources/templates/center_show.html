<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />
    <title>沙磁文旅</title>
    <script type="text/javascript" src="js/jquery.js"></script>
    <script type="text/javascript" src="js/echarts.min.js"></script>
    <script type="text/javascript" src="js/js.js"></script>
    <script type="text/javascript" src="js/jquery.limarquee.js"></script>
    <script type="text/javascript" src="js/jquery.cxselect.min.js"></script>
    <link href="css/style_sc.css" rel="stylesheet" type="text/css" />

    <link rel="stylesheet" href="css/comon0.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body>
<div style="background:#fff center top;">
    <div class="loading">
        <div class="loadbox"> <img src="picture/loading.gif"> 页面加载中... </div>
    </div>
    <div class="back"></div>
    <div class="head">
        <div class="weather"><span id="showTime"></span></div>
        <h1><a href="https://gitee.com/iGaoWei/big-data-view" style="color: white">沙磁文旅大数据可视化展示平台</a></h1>

    </div>
    <script>
        var t = null;
        t = setTimeout(time,1000);//開始运行
        function time()
        {
            clearTimeout(t);//清除定时器
            dt = new Date();
            var y=dt.getFullYear();
            var mt=dt.getMonth()+1;
            var day=dt.getDate();
            var h=dt.getHours();//获取时
            var m=dt.getMinutes();//获取分
            var s=dt.getSeconds();//获取秒
            document.getElementById("showTime").innerHTML = y+"年"+mt+"月"+day+"日"+h+"时"+m+"分"+s+"秒";
            t = setTimeout(time,1000); //设定定时器，循环运行
        }

    </script>
    <div class="container">
    <div class="tag1">任务管理<button onclick="getTask('月',currentDate(1))">按月</button>
        <button onclick="getTask('年',currentDate(2))">按年</button><span id="remark_time"></span>
        <div id="myChart" style=" height: 400px;"></div>
    </div>

    <div class="tag1">成本管理<button onclick="getCostManage('月',currentDate(1))">按月</button>
        <button onclick="getCostManage('年',currentDate(2))">按年</button>
        <div id="myChart2" style="height: 400px;"></div>
    </div>

    <div class="tag1">资金状况<button onclick="getCapital('月',currentDate(1))">按月</button>
         <button onclick="getCapital('年',currentDate(2))">按年</button>
         <div id="myChart3" style=" height: 400px;"></div>
     </div>

        <div class="tag1">任务管理<button onclick="getTask('月',currentDate(1))">按月</button>
            <button onclick="getTask('年',currentDate(2))">按年</button>
            <div id="myChart4" style=" height: 400px;"></div>
        </div>

    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
    $(function () {
        getTask("月",currentDate(1));
        getCostManage("月",currentDate(1));
        getCapital("月",currentDate(1));
      //  getManageState("月",currentDate(1));
    })


    function getTask(period,condition) {
        var myChart = echarts.init(document.getElementById('myChart'));
        var myChart4 = echarts.init(document.getElementById('myChart4'));
        $.ajax({
            type: "get",
            url: "/getTaskByCenter",
            headers: {
                'Authorization': localStorage.getItem("token") // 在请求头中添加token
            },
            data:({
                period:period,
                condition:condition
            }),
            success: function (res) {
                if(res && res.code===200){
                    if(period==="月"){
                        document.getElementById('remark_time').innerHTML="("+res.obj[0].remark+")";
                    }else {

                    }
                    var xAxisData =[];
                    var data1 =[];
                    var data2 =[];
                    var data3 =[];
                    var data4 =[];
                    for (let i = 0; i < res.obj.length; i++) {
                        xAxisData.push(res.obj[i].project);
                        data1.push(res.obj[i].totalNum);
                        data2.push(res.obj[i].completed);
                        data3.push(res.obj[i].unfinished);
                        data4.push(res.obj[i].overdue);
                    }

                    // 指定图表的配置项和数据
                    var option = {
                        title: {
                            text: ''
                        },
                        tooltip: {},
                        legend: {
                            data:['任务数','完成数','未完成数','逾期数']
                        },
                        xAxis: {
                            data:xAxisData,
                            axisTick: {
                                alignWithLabel: true
                            },
                            axisLabel: {
                                interval:0
                            }
                        },
                        yAxis: {
                            type: 'value',
                            autoScale: true // 开启自动缩放功能
                        },
                        series: [{
                            name: '任务数',
                            type: 'bar',
                            data: data1
                        },
                            {
                                name: '完成数',
                                type: 'bar',
                                data: data2
                            },
                            {
                                name: '未完成数',
                                type: 'bar',
                                data: data3
                            },
                            {
                                name: '逾期数',
                                type: 'bar',
                                data: data4
                            },
                        ]
                    };

                    // 使用刚指定的配置项和数据显示图表。
                    myChart.setOption(option);
                    myChart4.setOption(option);
                }

            }



        })


    }

    function getCostManage(period,condition) {
        var myChart2 = echarts.init(document.getElementById('myChart2'));
        $.ajax({
            type: "get",
            url: "/getCostManageByCenter",
            headers: {
                'Authorization': localStorage.getItem("token") // 在请求头中添加token
            },
            data:({
                period:period,
                condition:condition
            }),
            success: function (res) {
                if(res && res.code===200){
                    var pieData = []
                    for (let i = 0; i < res.obj.length; i++) {
                        pieData.push({name:"工资发放",value:res.obj[i].payOutWage});
                        pieData.push({name:"房租",value:res.obj[i].rent});
                        pieData.push({name:"水电办公等",value:res.obj[i].hydropowerOffice});
                        pieData.push({name:"工会",value:res.obj[i].laborUnion});
                    }
                    // 指定图表的配置项和数据
                    var option = {
                        grid: {
                            left: '1%', // 左侧距离容器左侧的距离
                            right: '1%', // 右侧距离容器右侧的距离
                            bottom: '1%', // 底部距离容器底部的距离
                            containLabel: true // 包含 label，防止被挤压到边角
                        },
                        series: [
                            {
                                type: 'pie',
                                data: pieData,
                                // 文字的显示
                                label: {
                                    show: true,
                                    // 决定文字显示的内容
                                    formatter: function(arg){
                                         var content =arg.name + '收入\n';
                                         content += arg.value + '元\n';
                                        return content;
                                    },
                                    position:'insideTop',
                                    fontSize: 10 // 增加字体大小
                                },
                                // radius: 20 //饼图的半径
                                //radius:'20%' //百分比参照的是宽度和高度中较小的那一部分的一半来进行百分比设置
                                //radius: ['50%','75%']//第0个元素代表的是内圆的半径 第1个元素外圆的半径
                                roseType: 'radius',//南丁格尔图 饼图的每一个区域的半径是不同的
                                //selectedMode: 'single' //选中的效果，能够将选中的区域偏离圆点一小段距离
                                selectedMode: 'multiple',
                                selectedOffset: 30
                            }
                        ]
                    }

                    // 使用刚指定的配置项和数据显示图表。
                    myChart2.setOption(option);
                }

            }



        })


    }

    function getCapital(period,condition) {
        var myChart3 = echarts.init(document.getElementById('myChart3'));
        $.ajax({
            type: "get",
            url: "/getCapitalByCenter",
            headers: {
                'Authorization': localStorage.getItem("token") // 在请求头中添加token
            },
            data:({
                period:period,
                condition:condition
            }),
            success: function (res) {
                if(res && res.code===200){
                    var xAxisData =[];
                    var data1 =[];
                    var data2 =[];
                    var data3 =[];
                    var data4 =[];
                    var data5 =[];
                    for (let i = 0; i < res.obj.length; i++) {
                        xAxisData.push(res.obj[i].remark);
                        data1.push(res.obj[i].income);
                        data2.push(res.obj[i].incomeTotal);
                        data3.push(res.obj[i].contractExpend);
                        data4.push(res.obj[i].specialExpend);
                        data5.push(res.obj[i].dailyExpend);
                    }
                    // 指定图表的配置项和数据
                    var option = {
                        title: {
                            text: ''
                        },
                        tooltip: {},
                        legend: {
                            data:['按月租赁收入','每月总收入','合同财务支出','专项债支出','日常报销支出']
                        },
                        xAxis: {
                            data:xAxisData,
                            axisTick: {
                                alignWithLabel: true
                            },
                            axisLabel: {
                                interval:0
                            }
                        },
                        yAxis: {
                            type: 'value',
                            autoScale: true // 开启自动缩放功能
                        },
                        series: [{
                            name:'按月租赁收入',
                            type: 'bar',
                            data: data1
                           },
                            {
                                name:'每月总收入',
                                type: 'bar',
                                data: data2
                            },
                            {
                                name:'合同财务支出',
                                type: 'line',
                                data: data3
                            },
                            {
                                name:'专项债支出',
                                type: 'line',
                                data: data4
                            },
                            {
                                name:'日常报销支出',
                                type: 'line',
                                data: data5
                            },
                        ]
                    };

                    // 使用刚指定的配置项和数据显示图表。
                    myChart3.setOption(option);

                }

            }



        })


    }
    function getManageState(period,condition) {
        var myChart4 = echarts.init(document.getElementById('myChart3'));
        $.ajax({
            type: "get",
            url: "/getManageStateByCenter",
            headers: {
                'Authorization': localStorage.getItem("token") // 在请求头中添加token
            },
            data:({
                period:period,
                condition:condition
            }),
            success: function (res) {
                if(res && res.code===200){
                    var xAxisData =[];
                    var data1 =[];
                    var data2 =[];
                    var data3 =[];
                    var data4 =[];
                    for (let i = 0; i < res.obj.length; i++) {
                        xAxisData.push(res.obj[i].project);
                        data1.push(res.obj[i].totalNum)
                        data2.push(res.obj[i].completed)
                        data3.push(res.obj[i].unfinished)
                        data4.push(res.obj[i].overdue)
                    }
                    // 指定图表的配置项和数据
                    var option = {
                        title: {
                            text: ''
                        },
                        tooltip: {},
                        legend: {
                            data:['任务数','完成数','未完成数','逾期数']
                        },
                        xAxis: {
                            data:xAxisData
                        },
                        yAxis: {
                            type: 'value',
                            autoScale: true // 开启自动缩放功能
                        },
                        series: [{
                            name: '任务数',
                            type: 'bar',
                            data: data1
                        },
                            {
                                name: '完成数',
                                type: 'bar',
                                data: data2
                            },
                            {
                                name: '未完成数',
                                type: 'bar',
                                data: data3
                            },
                            {
                                name: '逾期数',
                                type: 'bar',
                                data: data4
                            },
                        ]
                    };

                    // 使用刚指定的配置项和数据显示图表。
                    myChart4.setOption(option);

                }

            }



        })


    }

    //获取年月日

    function currentDate(type) {
        var date = new Date(); // 创建Date对象
        // 获取年、月、日、小时、分钟和秒
        var year = date.getFullYear();
        var month = date.getMonth() + 1; // 月份从0开始，所以要加1
        var day = date.getDate();
        var hours = date.getHours();
        var minutes = date.getMinutes();
        var seconds = date.getSeconds();
        // 将日期和时间组件组合成字符串
        var formatteddate = year + '-' + month;
        var formattedTime = year + '-' + month + '-' + day;
        if(type==1){
            return formatteddate;
        }else {
            return year;
        }

    }
</script>
</body>
</html>